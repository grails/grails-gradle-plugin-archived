<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Grails Gradle Plugin 2.1.1</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#usage"><strong>2</strong><span>Using the Plugin</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#advanced"><strong>3</strong><span>Advanced Plugin Configuration &amp; Usage</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p>Grails Gradle Plugin</p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>Grails Gradle Plugin - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Luke Daley, Graeme Rocher, Peter Ledbrook, John Engelman</p>
                            <p><strong>Version:</strong> 2.1.1</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#quickstart"><strong>1.1</strong><span>Quick Start</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#commands"><strong>1.2</strong><span>Basic Task Reference</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#changes"><strong>1.3</strong><span>Change Log</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#usage"><strong>2</strong><span>Using the Plugin</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#init"><strong>2.1</strong><span>Initializing a Grails Project</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#deps"><strong>2.2</strong><span>Configuring Project Dependencies</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#run"><strong>2.3</strong><span>Running a Grails Project</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#test"><strong>2.4</strong><span>Running Tests</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#scripts"><strong>2.5</strong><span>Executing Grails Scripts</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#package"><strong>2.6</strong><span>Packaging a Grails Project</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#config"><strong>2.7</strong><span>Configuring Plugin Properties</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#upgrade"><strong>2.8</strong><span>Upgrading a Grails Application</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#advanced"><strong>3</strong><span>Advanced Plugin Configuration &amp; Usage</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#overview"><strong>3.1</strong><span>Overview of Plugin Integration with Grails</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#args"><strong>3.2</strong><span>Passing arguments to Grails Tasks</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#env"><strong>3.3</strong><span>Setting the Grails Environment</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#debug"><strong>3.4</strong><span>Debugging Grails tasks</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#memory"><strong>3.5</strong><span>Configuring JVM Memory for Grails Tasks</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#logging"><strong>3.6</strong><span>Capturing Grails task output to INFO log</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#plugins"><strong>3.7</strong><span>Managing Grails Plugins with Gradle</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction</h1>
The Grails Gradle Plugin provides integration of Grails applications into the Gradle framework. In simple terms,
this plugin allows Gradle to build Grails applications in a compatible way with the internal build tooling of the
Grails framework.



<h2 id="quickstart">1.1 Quick Start</h2>
The following <code>build.gradle</code> example shows a Grails application configuration in Gradle that matches the default configuration
generated by Grails for new projects. Not all the dependencies are required for every application.<p class="paragraph"/><div class="code"><pre>buildscript &#123;
    repositories &#123;
        jcenter()
    &#125;
    dependencies &#123;
        'org.grails:grails&#45;gradle&#45;plugin:2.1.0'
    &#125;
&#125;<p class="paragraph"/>apply plugin: 'grails'<p class="paragraph"/>grails &#123;
    grailsVersion = '2.4.0' // Specifies the Grails version to use
    groovyVersion = '2.3.1' // Specify the Groovy version to use (should match the version that ships with the above Grails version)
    springLoadedVersion = '1.2.0.RELEASE' // Specify the Spring Loaded version to use
&#125;<p class="paragraph"/>repositories &#123;
    jcenter()
    grails.central() //Adds the Grails Central Repository <span class="java&#45;keyword">for</span> resolving Grails plugins (replaces grailsPlugins(), grailsCentral() from BuildConfig.groovy)
&#125;<p class="paragraph"/>dependencies &#123;
    bootstrap 'org.grails.plugins:tomcat:7.0.50.1'<p class="paragraph"/>    compile 'org.grails.plugins:scaffolding:2.0.2'
    compile 'org.grails.plugins:cache:1.1.1'<p class="paragraph"/>    runtime 'org.grails.plugins:hibernate:3.6.10.8' //or 'org.grails.plugins:hibernate4:4.3.1.1'
    runtime 'org.grails.plugins:database&#45;migration:1.3.8'
    runtime 'org.grails.plugins:jquery:1.11.0'
    runtime 'org.grails.plugins:resources:1.2.2'<p class="paragraph"/>    //runtime 'mysql:mysql&#45;connector&#45;java:5.1.24'
    //runtime 'org.postgresql:postgresql:9.3.1100&#45;jdbc41'<p class="paragraph"/>    //Additional resources capabilities
    //runtime 'org.grails.plugins:zipped&#45;resources:1.0.1'
    //runtime 'org.grails.plugins:cached&#45;resources:1.1'
    //runtime 'org.grails.plugins:yui&#45;minify&#45;resources:0.1.5'<p class="paragraph"/>    //Alternate to the resources plugin
    //compile 'org.grails.plugins:asset&#45;pipeline:1.5.0'<p class="paragraph"/>    //Additional asset&#45;pipeline capabilities
    //compile 'org.grails.plugins:sass&#45;asset&#45;pipeline:1.5.1'
    //compile 'org.grails.plugins:less&#45;asset&#45;pipeline:1.5.0'
    //compile 'org.grails.plugins:coffee&#45;asset&#45;pipeline:1.5.0'
    //compile 'org.grails.plugins:handlebars&#45;asset&#45;pipeline:1.0.0.3'
&#125;</pre></div><p class="paragraph"/><blockquote class="warning">
If you are using a version of Grails that is &#60; <code>1.3.5</code> or <code>1.2.4</code>, the following <code>runtime</code> dependency <strong class="bold">MUST</strong> be added:
<div class="code"><pre>runtime 'org.aspectj:aspectjrt:1.6.8'</pre></div>
</blockquote>



<h2 id="commands">1.2 Basic Task Reference</h2>
Applying the plugin creates the following default tasks in the Gradle project. Task dependencies are declared in brackets.
<ul class="star">
<li><code>run</code></li>
<li><code>test</code></li>
<li><code>war</code></li>
<li><code>packagePlugin</code></li>
</ul><p class="paragraph"/>Additionally, the plugin creates set of default Gradle tasks to mimic the behavior of a standard Gradle Java project.
These tasks are wired to the corresponding <code>GrailsTask</code> to provide the behavior.
<ul class="star">
<li><code>clean</code></li>
<li><code>test</code></li>
<li><code>check</code> &#91;<code>test</code>&#93;</li>
<li><code>assemble</code> &#91;<code>war</code> or <code>packagePlugin</code>&#93;</li>
<li><code>build</code> &#91;<code>assemble</code>, <code>check</code>&#93;</li>
</ul><p class="paragraph"/>Finally, the plugin creates a Gradle Task Rule that allows for execution of any arbitrary Grails script by prefixing
the script name with <code>grails-</code>
<div class="code"><pre>$ gradle grails&#45;s2&#45;quickstart //Execute the s2&#45;quickstart script from the Spring Security Core plugin</pre></div>


<h2 id="changes">1.3 Change Log</h2>
<h4>2.1.1</h4>
<ul class="star">
<li>Configure <code>war</code> task to use <code>production</code> environment by default - <a href="https://github.com/grails/grails-gradle-plugin/issues/101" target="blank">ISSUE-101</a></li>
<li>Handle No signature of method: LinePerThreadBufferingOutputStream.writeTo(LinePerThreadBufferingOutputStream) error - <a href="https://github.com/grails/grails-gradle-plugin/issues/120" target="blank">ISSUE-120</a></li>
<li>Add <code>captureOutputToInfo</code> property to <code>GrailsTask</code> which properly captures streams to INFO logger unless error occurs. Disabled by default</li>
</ul><p class="paragraph"/><h4>v2.1.0</h4>
<ul class="star">
<li>Renamed default tasks created by plugin: - <a href="https://github.com/grails/grails-gradle-plugin/issues/81" target="blank">ISSUE-81</a></li>
<ul class="star">
<li><code>run</code> replaces <code>grails-run-app</code></li>
<li><code>test</code> replaces <code>grails-test-app</code></li>
<li><code>war</code> replaces <code>grails-war</code></li>
<li><code>packagePlugin</code> replaces <code>grails-package-plugin</code></li>
</ul>
<li>Added the <code>reload</code> property <code>GrailsTask</code> to enabled SpringLoaded class reloading for a task.  - "ISSUE-84": https://github.com/grails/grails-gradle-plugin/issues/84</li>
<li>Configure the static <code>run</code> task and dynamic <code>grails-run-app</code> task to enabled reloading by default.</li>
<li>Removed creating the <code>grails-clean</code> task by default. Configure the normal <code>clean</code> task to delete the <code>buildPlugins/</code> directory.</li>
<li>Fix a bug in the IntelliJ IDEA integration where only 1 plugin per configuration was being registered as project source</li>
<li>Include bootstrap scope plugins as project source in IntelliJ IDEA</li>
<li>Mark test scope plugins directories as Test Source instead of Source in IntelliJ IDEA</li>
<li>Support new Maven group name for SpringLoaded library starting with v1.1.5.RELEASE</li>
<li>Add support to automatically synchronize <code>app.version</code> and <code>app.grails.version</code> in the <code>application.properties</code></li>
</ul><p class="paragraph"/>  file to <code>project.version</code> and <code>project.grails.grailsVersion</code> respectively - <a href="http://jira.grails.org/browse/MAVEN-137" target="blank">MAVEN-137</a>
<ul class="star">
<li>Correctly mapped <code>provided</code> scope dependencies to the Grails environment</li>
<li>Allow passing of the <code>-PgrailsDebug=true</code> flag to all Grails tasks.  - <a href="https://github.com/grails/grails-gradle-plugin/issues/97" target="blank">ISSUE-97</a></li>
</ul><p class="paragraph"/><h4>v2.0.1</h4>
<ul class="star">
<li>Fix a bug in setting <code>grails.groovyVersion</code> which resulted in an exception when a dependency tried to include the groovy library.</li>
<li>Fix a bug where when a <code>GrailsTestTask</code> is configured with both a set of Task Inputs and a <code>testResultsDir</code> that results in an exception because <code>testResultsDir</code> is a directory but Gradle expects it to be a file.</li>
<li>Fix a bug in the task dependency configuration for the <code>clean</code> task that results in Gradle being unable to determine the task graph.</li>
<li>Add plugin Zip file or application War file as an output file to the runtime configuration.</li>
<li>Configured the default configuration to extend from runtime (similar to Java plugin behavior)</li>
<li>Springloaded is only configured for the <code>grails-run-app</code> task (this is what Grails itself does in <code>grailsStart</code> script).</li>
<li>Added the <code>init-plugin</code> task to initialize a Grails plugin instead of an application.</li>
<li>The <code>grails-run-app</code> task is now  available on plugin projects as well (Grails allows this)</li>
</ul><p class="paragraph"/>


<h1 id="usage">2 Using the Plugin</h1>
The Grails Gradle Plugin is available from Bintray's JCenter and the Maven Central repositories. Apply it to a Gradle
project the same way as any other plugin:<p class="paragraph"/><div class="code"><pre>buildscript &#123;
    repositories &#123;
        jcenter()
    &#125;
    dependencies &#123;
        classpath 'org.grails:grails&#45;gradle&#45;plugin:2.0.1'
    &#125;
&#125;<p class="paragraph"/>apply plugin: 'grails'<p class="paragraph"/>version = 1.0<p class="paragraph"/>grails &#123;
    grailsVersion = '2.3.6'
    groovyVersion = '2.1.9'
&#125;<p class="paragraph"/>repositories &#123;
    grails.central()
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
The plugin requires that the <code>grails.grailsVersion</code> is specified for the project. Additionally, the <code>version</code> property
is required for executing the <code>init</code> task since Grails needs the application version during project initialization.
</blockquote><p class="paragraph"/><blockquote class="note">
While the <code>grails.groovyVersion</code> property is not required, specifying it allows the plugin to properly configure the
Groovy runtime for the <code>bootstrap</code> and <code>compile</code> classpaths. Additionally, specifying it will configure a Gradle
<code>ResolutionStrategy</code> to prevent different versions of <code>groovy</code> or <code>groovy-all</code> from entering the classpath through
dependencies.
</blockquote><p class="paragraph"/><blockquote class="note">
If you are using the Grails Gradle Plugin to build applications with a version of Grails prior to 2.3.0, configuring the
<code>grails.groovyVersion</code> property may have some side effects.
</blockquote><p class="paragraph"/><blockquote class="warning">
Specifying a <code>grails.groovyVersion</code> that does not match the Groovy version supplied with the specified <code>grails.grailsVersion</code>
is not supported. It is possible to make this configuration, but unforeseen behavior may occur.
</blockquote>


<h2 id="init">2.1 Initializing a Grails Project</h2>
Once the plugin is applied, a new Grails project can be initialized through Gradle.<p class="paragraph"/><div class="code"><pre>$ gradle init //Initializes a Grails application</pre></div><p class="paragraph"/>OR<p class="paragraph"/><div class="code"><pre>$ gradle init&#45;plugin //Initializes a Grails plugin</pre></div><p class="paragraph"/>Both tasks initialize the Grails project in the current working directory.<p class="paragraph"/><blockquote class="note">
The plugin initializes the application/plugin with the name of the Gradle project and the current Gradle project version
</blockquote>


<h2 id="deps">2.2 Configuring Project Dependencies</h2>
Using the Grails Gradle Plugin bypasses the normal Grails application build framework in favor of Gradle. The consequence
of this is that the <code>BuildConfig.groovy</code> is no longer consulted for repository or dependency information. All repositories
and dependencies <strong class="bold">MUST</strong> be configured via Gradle.<p class="paragraph"/><blockquote class="note">
Because Grails is no longer resolving the dependency information, the short syntax for plugins cannot be used:<p class="paragraph"/><div class="code"><pre>plugins &#123;
  compile ':resources:1.1.1'
&#125;</pre></div><p class="paragraph"/>In Grails, the syntax omits the Maven groupId for Grails plugins because all public Grails plugins are published under
the <code>org.grails.plugins</code> groupId. With Gradle, the groupId <strong class="bold">MUST</strong> be specified:<p class="paragraph"/><div class="code"><pre>dependencies &#123;
    compile 'org.grails.plugins:resources:1.1.1'
&#125;</pre></div>
</blockquote><p class="paragraph"/>The Grails Gradle Plugin configures the following scopes for dependency resolution: <code>bootstrap</code>, <code>provided</code>, <code>compile</code>,
<code>runtime</code>, <code>test</code>. These scopes map to the same scopes normally used in <code>BuildConfig.groovy</code>.


<h2 id="run">2.3 Running a Grails Project</h2>
The Grails Gradle Plugin creates a <code>run</code> task on the project that will start the Grails application container
in the normal development environment by executing the Grails <code>run-app</code> script.<p class="paragraph"/><div class="code"><pre>$ gradle run</pre></div><p class="paragraph"/>Grails does not ship with an application container provided, so the build must specify a Grails plugin dependency. Typically,
this will be the Grails tomcat plugin:<p class="paragraph"/><div class="code"><pre>depedencies &#123;
    bootstrap 'org.grails.plugins:tomcat:7.0.50'
&#125;</pre></div><p class="paragraph"/>By default, the plugin configures the <code>run</code> task and dynamic <code>grails-run-app</code> task to enabled class reloading via
SpringLoaded. Other other tasks created by the plugin or dynamically created via the Grails Script pattern will
have reloading disabled. To enable reloading for <code>GrailsTask</code>, define the task and configure the <code>reload</code> property
to <code>true</code>.<p class="paragraph"/><blockquote class="note">
Running the <code>run</code> task will prevent the Gradle execution from completing (i.e. the task blocks on the running container).
To terminate the Grails application, use Ctrl+C to terminate the Gradle run
</blockquote>


<h2 id="test">2.4 Running Tests</h2>
The Grails Gradle Plugin configures a <code>test</code> task that executes the projects tests through the Grails framework.
Additionally, the plugin configures the normal Gradle <code>check</code> task with a dependency on <code>test</code>.<p class="paragraph"/><div class="code"><pre>$ gradle test
:test
| Loading Grails 2.3.5
&#8230;
| Tests PASSED &#45; view reports in /Users/jengelman/workspace/personal/gg&#45;test/build/test&#45;results<p class="paragraph"/>BUILD SUCCESSFUL<p class="paragraph"/>Total time: 14.181 secs<p class="paragraph"/>$ gradle check
:grails&#45;test&#45;app UP&#45;TO&#45;DATE
:test UP&#45;TO&#45;DATE
:check UP&#45;TO&#45;DATE<p class="paragraph"/>BUILD SUCCESSFUL<p class="paragraph"/>Total time: 1.177 secs</pre></div><p class="paragraph"/>The plugin configures test results by default to be output to <code>build/test-results</code><p class="paragraph"/><h4>Running Specific Test Phases</h4><p class="paragraph"/>The <code>GrailsTestTask</code> allows for configuring the specific test phases through the <code>phases</code> property. By default the
<code>test</code> task is configured with no phases which results in Grails executing <strong class="bold">ALL</strong> test phases. This can be
modified as such:<p class="paragraph"/><div class="code"><pre>test &#123;
    phases = &#91;'unit:', 'integration:'&#93;
&#125;</pre></div><p class="paragraph"/>The above block will configure <code>test</code> to only execute the <code>unit</code> and <code>integration</code> test phases.<p class="paragraph"/><blockquote class="note">
The <code>phases</code> property of <code>GrailsTestTask</code> gets passed to Grails's <code>test-app</code> command directly. Therefore, you must provide
content that is compatible with the <code>test-app</code> script. Grails test phase/type selection is of the form <code>&#60;phase&#62;:&#60;type&#62;</code>.
Valid syntaxes include (not a complete list): <code>unit:</code>, <code>unit:unit</code>, <code>unit:spock</code>, <code>:spock</code>, etc.<p class="paragraph"/><div class="code"><pre>phases = &#91;'unit:'&#93; //Execute all tests types in the unit phase
phases = &#91;'integration:spock'&#93; //Execute all Spock tests in the integration phase
phases = &#91;':unit'&#93; //Execute all JUnit test type in all phases</pre></div><p class="paragraph"/>Refer to the section <a href="http://grails.org/doc/latest/guide/single.html#testing" target="blank">Targeting Test Types and/or Phases</a> in the
Grails User Guide for additional information.
</blockquote><p class="paragraph"/><h4>Configuring a Test Task Rule</h4><p class="paragraph"/>It may be beneficial to configure a Gradle task rule to execute specific test phases from the command line. This can
be accomplished as so:<p class="paragraph"/><div class="code"><pre>project.tasks.addRule('Pattern: test&#60;Phase&#62;') &#123; <span class="java&#45;object">String</span> taskName &#45;&#62;
    <span class="java&#45;keyword">if</span> (taskName.startsWith('test')) &#123;
        task(taskName, type: GrailsTestTask) &#123;
            <span class="java&#45;object">String</span> testPhase = (taskName &#45; 'test').toLowerCase()
            phases = &#91;testPhase + ':'&#93;
        &#125;
    &#125;
&#125;<p class="paragraph"/>$ gradle testUnit //Execute the unit test phase</pre></div><p class="paragraph"/><blockquote class="note">
When adding a a TaskRule for Grails tasks, avoid using a prefix that begins with <div class="code"><pre>grails&#45;</pre></div>. This is the prefix
that the plugin uses for executing arbitrary Grails scripts. Gradle doesn't provide a method to order TaskRules, so
using this prefix will likely result in a duplicate task exception.
</blockquote><p class="paragraph"/><h4>Running Specific Tests</h4><p class="paragraph"/>In matching with the Gradle standard, use the <code>-Dtest.single</code> property to defined single tests to run. The <code>GrailsTestTask</code>
observes this system property and will pass the value as is to the Grails test task.<p class="paragraph"/><div class="code"><pre>$ gradle test &#45;Dtest.single=FooController</pre></div><p class="paragraph"/><blockquote class="note">
The <code>--test</code> syntax introduced in  Gradle 1.10 is not supported for selecting tests to execute. This is because the plugin
is delegating to the underlying <code>GrailsLauncher</code> to execute tests and not using Gradle's <code>Test</code> class as a base. All the
normal test selection methods for the Grails <a href="http://grails.org/doc/latest/ref/Command%20Line/test-app.html" target="blank"><code>test-app</code></a>
command are supported since the value of <code>test.single</code> is passed directly as a command line argument to the Grails script.<p class="paragraph"/><div class="code"><pre>$ gradle test &#45;Dtest.single=<span class="java&#45;quote">"Foo Bar"</span></pre></div>
</blockquote><p class="paragraph"/><h4>Setting the Test Results Output Directly</h4><p class="paragraph"/>If multiple <code>GrailsTestTasks</code> are configured in a project and are part of the normal build process, it may be benefical
to configure each task to output its test results to a different directory. By default, Grails cleans the test output
directory before running tests so that the test report matches the tests executed. Use the <code>testResultsDir</code> property on
<code>GrailsTestTask</code> to configure the test output directory.<p class="paragraph"/><div class="code"><pre>task unit(type: GrailsTestTask) &#123;
    testResultsDir = file('build/reports/test&#45;unit')
    phases = &#91;'unit:'&#93;
&#125;<p class="paragraph"/>task integration(type: GrailsTestTask) &#123;
    testResultsDir = file('build/reports/test&#45;<span class="java&#45;object">int</span>')
    phases = &#91;'integration:'&#93;
&#125;<p class="paragraph"/>test.enabled = <span class="java&#45;keyword">false</span> // Disable the <span class="java&#45;keyword">default</span> test task that executes all phases
check.dependsOn &#91;unit, integration&#93; // Configure test phase tasks to execute on the 'check' task</pre></div>


<h2 id="scripts">2.5 Executing Grails Scripts</h2>
The plugin configures a Gradle Task Rule to allow execution of any available Grails scripts as Gradle tasks. Simply
prefix the Grails script name with <code>grails-</code> and execute from Gradle.<p class="paragraph"/><div class="code"><pre>$ gradle grails&#45;refresh&#45;dependencies</pre></div><p class="paragraph"/><blockquote class="note">
Similar to the behavior of Grails itself, the provided script will be passed as the execution for Grails. If the
requested script is provided via a Grails plugin that is not yet installed, then the execution will fail because plugin
resolution in Grails occurs after validating the script. This can be avoided by executing a <code>gradle assemble</code> so that
Grails compilation &#38; plugin resolution occurs after adding a new Grails plugin to the build dependencies.
</blockquote>


<h2 id="package">2.6 Packaging a Grails Project</h2>
The Grails Gradle Plugin configures the normal Gradle <code>assemble</code> task to execute the appropriate Grails command for
creating the project's output. For applications, the <code>assemble</code> task depends on <code>war</code> which executes the Grails <code>war</code>
script and produces a War output.
For plugins, the <code>assemble</code> task depends on <code>packagePlugin</code> which executes the Grails <code>package-plugin</code> script
and produces the plugin Zip output.<p class="paragraph"/>Additionally, the plugin configures the normal Gradle <code>build</code> task to depend on <code>test</code> and <code>assemble</code>


<h2 id="config">2.7 Configuring Plugin Properties</h2>
The plugin provides a number of properties that can be configure for each build. These properties are configure
through the <code>grails</code> extension in the Gradle build:<p class="paragraph"/><div class="code"><pre>grails &#123;
    grailsVersion = '2.3.6'
    groovyVersion = '2.1.9'
    springLoadedVersion = '1.1.3'
&#125;</pre></div><p class="paragraph"/><h4>GrailsVersion</h4><p class="paragraph"/>The <code>grailsVersion</code> property specifies the version of Grails to build the application against. This will transitively
include a number of Grails libraries onto the classpath for compilation.<p class="paragraph"/><h4>GroovyVersion</h4><p class="paragraph"/>The <code>groovyVersion</code> property specifies the version of Groovy to use to build the application. This is a convenience method.
By setting this property, the plugin will add the specified version of the <code>groovy-all</code> library to both the <code>boot</code> and
<code>compile</code> configurations. Additionally, it will configure a <code>ResolutionStrategy</code> rule to convert all requests for <code>groovy-all</code>
to use this version for the dependency and all requests for the standard <code>groovy</code> library will be converted to request
the <code>groovy-all</code> library instead.<p class="paragraph"/><blockquote class="note">
If you are using the Grails Gradle Plugin to build applications with a version of Grails prior to 2.3.0, configuring the
<code>grails.groovyVersion</code> property may have some side effects.
</blockquote><p class="paragraph"/><blockquote class="warning">
Specifying a <code>grails.groovyVersion</code> that does not match the Groovy version supplied with the specified <code>grails.grailsVersion</code>
is not supported. It is possible to make this configuration, but unforeseen behavior may occur.
</blockquote><p class="paragraph"/><h4>SpringLoadedVersion</h4><p class="paragraph"/>The <code>springLoadedVersion</code> property specifies the version of the SpringLoaded library to place on the classpath when
executing the <code>run</code> or <code>grails-run-app</code> tasks. This library enables class reloading. Internally, the plugin configures a
Java Agent using this library which performs the reload in the JVM. The plugin configures a default version of the library,
and this property can be used to specify a different version than the default.<p class="paragraph"/>By default, the plugin only configures the springLoaded library and reloading on the <code>run</code> and <code>grails-run-app</code> tasks.


<h2 id="upgrade">2.8 Upgrading a Grails Application</h2>
Grails ships with an <code>upgrade</code> that is used to upgrade an application or plugin from one version of Grails
to another. Use of this command is <strong class="bold">NOT</strong> supported via the Grails-Gradle plugin. This script requires an actual
Grails installation on the machine.<p class="paragraph"/>Instead, the plugin will automatically modify the <code>application.properties</code> to reflect both the version of
Grails and the application's version (as specific by <code>grails.grailsVersion</code> and <code>project.version</code>
respectively). This synchronization will occur as the during any <code>GrailsTask</code>.<p class="paragraph"/><blockquote class="note">
This behavior is identical to the behavior of Maven enabled Grails packages as stated in 
<a href="http://jira.grails.org/browse/MAVEN-137" target="blank">MAVEN-137</a>
</blockquote><p class="paragraph"/><blockquote class="warning">
The Grails version synchronization will allow you to change the Grails version via the <code>build.gradle</code> file, however, it
will <strong class="bold">NOT</strong> apply any upgrades that maybe be obtained through a normal <code>grails upgrade</code> process. It is the responsibility
of the user to manually apply any differences that may occur.<p class="paragraph"/>A good resource for this is the <a href="http://grails.org/doc/latest/guide/introduction.html." target="blank">What's new in Grails x.y</a><p class="paragraph"/>Alternatively, you can initialize a new project with the new Grails version and compare the 2 directories with your
favorite diff tool.
</blockquote>


<h1 id="advanced">3 Advanced Plugin Configuration & Usage</h1>
This section covers advanced topics in the Gradle Grails Plugin. It includes topics related to configuring the
underlying JVM that is executing the Grails tasks and integrating Grails builds into larger multi-project build.


<h2 id="overview">3.1 Overview of Plugin Integration with Grails</h2>
Integration of Grails into Gradle via this plugin is a complicated endeavour. The Grails framework contains its own
build tooling that performs source compilation, test execution, and artifact packaging. Additionally, it has an extensive
and mature plugin community of its own. Each plugin can add its own scripts to a Grails build and provide additional
dependencies.<p class="paragraph"/>Because Grails contains is own build tooling, Grails projects, despite being based on Java &#38; Groovy, do <strong class="bold">NOT</strong> use
the Groovy, Java, or War plugins for Gradle. As a consequence, these projects lose many of the conveniences for
configuration that a standard Gradle project would receive. The Gradle Grails Plugin tries to address many of these
shortcomings but some may not be possible with the current state of the frameworks.<p class="paragraph"/><blockquote class="note">
The Grails 3 Road Map currently includes re-writing the Grails build system to be based on Gradle.
</blockquote><p class="paragraph"/>The Grails Gradle Plugin integrates with Grails through another library <a href="https://github.com/grails/grails-launcher." target="blank">Grails Launcher</a>
This library functions by creating a <code>LaunchContext</code> instance that contains the necessary classpath information,
script name, and arguments and serializing it to disk in a known location. Gradle then forks a JVM instance that will
execute the <code>Main</code> class in the Grails Launcher project with the path to the serialized <code>LaunchContext</code>.<p class="paragraph"/>The Grails Launcher project is a library that integrates at a low-level into the Grails framework. In short, it
configures the JVM is the same manner that the <code>grails</code> scripts on the command line do when executing Grails natively.


<h2 id="args">3.2 Passing arguments to Grails Tasks</h2>
The plugin tries to configure the known Grails tasks to the best of its abilities. However, sometimes additional
parameters are necessary to be be passed from the command line. In order to pass options to the underlying JVM that
is forked using the <code>grailsArgs</code> system property from the command line:<p class="paragraph"/><div class="code"><pre>$ gradle &#45;PgrailsArgs=<span class="java&#45;quote">"FooController"</span> grails&#45;create&#45;controller</pre></div><p class="paragraph"/>The above line with pass the <code>FooController</code> string to the underlying Grails <code>create-controller</code> command.<p class="paragraph"/><blockquote class="note">
The <code>grailsArgs</code> property is a single system property. You can only specify it once and it is not parsed in anyway before
being passed to the Grails JVM. It is strongly recommended to use "" around the value being passed to avoid any type of
shell interpretation of the value.
</blockquote><p class="paragraph"/><blockquote class="note">
The <code>grailsArgs</code> property is wired <strong class="bold">ONLY</strong> to dynamically created tasks using the <code>grails-</code> prefix. Tasks created by
the plugin are intended to provide for a repeatable build experience and as such do <strong class="bold">NOT</strong> accept additional parameters
via the command line. The proper way to configure these tasks is via the Gradle build file
</blockquote>


<h2 id="env">3.3 Setting the Grails Environment</h2>
The plugin allows you to override the Grails environment on the command line by using the <code>grailsEnv</code> property on the
command line:<p class="paragraph"/><div class="code"><pre>$ gradle &#45;PgrailsEnv=prod grails&#45;run&#45;app</pre></div><p class="paragraph"/>The above command will execute the Grails <code>run-app</code> command in the <code>prod</code> environment.<p class="paragraph"/><blockquote class="note">
The <code>PgrailsEnv</code> property is wired <strong class="bold">ONLY</strong> to dynamically created tasks using the <code>grails-</code> prefix. Tasks created by
the plugin are intended to provide for a repeatable build experience and as such do <strong class="bold">NOT</strong> accept additional parameters
via the command line. The proper way to configure these tasks is via the Gradle build file
</blockquote>


<h2 id="debug">3.4 Debugging Grails tasks</h2>
The plugin allows Grails tasks to enable a debugger by setting the <code>grailsDebug</code> property to <code>true</code>.<p class="paragraph"/><div class="code"><pre>$ gradle &#45;PgrailsDebug=<span class="java&#45;quote">"<span class="java&#45;keyword">true</span>"</span> run</pre></div><p class="paragraph"/>The above command will execute the Grails <code>run-app</code> command with debug mode activated. This flag sets the debug mode
by setting <code>jvmOptions.debug=true</code> on the underlying Gradle <code>JavaExec</code> instance for the Grails task. By default this
activates debugging in a suspended mode on port 5005.<p class="paragraph"/><blockquote class="note">
The <code>grailsDebug</code> is passed to <strong class="bold">ALL</strong> Grails tasks in Gradle.
</blockquote><p class="paragraph"/>To manually configure the debug properties (i.e., suspend mode, port, etc) for the tasks,
configure the options via the <code>jvmOptions.jvmArgs</code> property:<p class="paragraph"/><div class="code"><pre>run &#123;
  jvmOptions &#123;
    jvmArgs(&#91;
      '&#45;Xdebug',
      '&#45;Xnoagent',
      '&#45;Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5006'
    &#93;)
  &#125;
&#125;</pre></div><p class="paragraph"/>The above block configures the JVM that Grails executes in to have a remote debugger on port 5006 and does <strong class="bold">NOT</strong>
suspend the JVM on startup.<p class="paragraph"/>



<h2 id="memory">3.5 Configuring JVM Memory for Grails Tasks</h2>
Grails applications are known for quickly growing in memory size (especially in PermGen). Currently, the plugin makes
no efforts to configure the memory settings for the Grails JVM. By default then, the Grails JVM will have the same
memory settings as the Gradle JVM which forked it.<p class="paragraph"/>Each <code>GrailsTask</code> exposes a <code>jvmOptions</code> property that can be used to configure the underlying JVM. The <code>jvmOptions</code>
property is an instance of <a href="http://www.gradle.org/docs/current/javadoc/org/gradle/process/JavaForkOptions.html" target="blank">JavaForkOptions</a>
and all the properties and methods from that class are available.<p class="paragraph"/><div class="code"><pre>run &#123;
    jvmOptions &#123;
        minHeapSize = '512m'
        maxHeapSize = '1g'
        jvmArgs '&#45;XX:MaxPermSize=512m'
    &#125;
&#125;</pre></div><p class="paragraph"/>Alternatively, it may be beneficial to configure all the <code>GrailsTask</code> in the build to have the same memory settings.<p class="paragraph"/><div class="code"><pre>project.tasks.withType(GrailsTask) &#123; GrailsTask task &#45;&#62;
    task.jvmOptions &#123;
        minHeapSize = '512m'
        maxHeapSize = '1g'
        jvmArgs '&#45;XX:MaxPermSize=512m'
    &#125;
&#125;</pre></div>


<h2 id="logging">3.6 Capturing Grails task output to INFO log</h2>
By default <code>GrailsTask</code>s will send their output and error stream to <code>System.out</code> and <code>System.err</code> respectively.
However, any task can be configured to instead capture their output to the <code>Logger.INFO</code> level by setting the
<code>captureOutputToInfo</code> property to <code>true</code> on the task. When enabled, the task will capture its output and error streams
to a buffer. If the task encounters an error, then both the output and error streams will be rendered onto <code>System.out</code>
and <code>System.err</code> respectively.<p class="paragraph"/>This allows a successful build to minimize the amount of logging produced to the console during the build and also
allows the output from failed tasks in a parallel multi-project build to rendered their output without interleaving
it with the output of other tasks.<p class="paragraph"/>The property can be configured on all <code>GrailsTask</code> instances using the following:<p class="paragraph"/><div class="code"><pre>project.tasks.withType(GrailsTask) &#123;
  captureOutputToInfo = <span class="java&#45;keyword">true</span>
&#125;</pre></div>



<h2 id="plugins">3.7 Managing Grails Plugins with Gradle</h2>
The plugin configures the <code>build</code> task to call the appropriate <code>package-plugin</code> task for Grails plugin projects to produce
the plugin zip file. Additionally, the plugin configures the Gradle configuration inheritance so that including Grails
plugin projects via a Gradle <code>project</code> dependency should include the transitive dependencies for the plugin.<p class="paragraph"/><h4>Plugin Publication</h4><p class="paragraph"/><blockquote class="warning">
Plugin Publication is not fully supported at this time. Additional information will be added to this page as use cases
are defined.
</blockquote><p class="paragraph"/><h5>Publishing a Simple Grails Plugin</h5><p class="paragraph"/>For simple Grails plugin projects, that is projects that have <strong class="bold">NO</strong> external dependencies, plugin release and publication
can be accomplished using the <a href="http://grails.org/plugin/release." target="blank">Grails Release Plugin</a> Add the <code>release</code> plugin to
the <code>bootstrap</code> configuration and execute the <code>grails-release-plugin</code> task.<p class="paragraph"/><div class="code"><pre>dependencies &#123;
    bootstrap 'org.grails.plugin:release:2.2.1'
&#125;<p class="paragraph"/>$ gradle grails&#45;release&#45;plugin</pre></div><p class="paragraph"/><blockquote class="warning">
See the plugin page http://grails.org/plugin/release for compatibility notes regarding the release plugin and the Grails version
</blockquote><p class="paragraph"/><blockquote class="note">
Using the Release Plugin is only supported when there are no external dependencies because the <code>release-plugin</code> command
utilizes the dependencies configured in <code>BuildConfig.groovy</code> to build the plugin's <code>pom.xml</code> file. Since dependencies
are being configure through Gradle, the <code>BuildConfig.groovy</code> will not have the correct information and the <code>pom.xml</code>
will be incorrect (especially when using Gradle <code>project</code> dependencies).
</blockquote><p class="paragraph"/><h5>Publishing Using the Gradle Maven Plugin</h5><p class="paragraph"/>Plugin publication using the <a href="http://www.gradle.org/docs/current/userguide/artifact_management.html" target="blank"><code>maven</code></a> plugin is
currently untested.<p class="paragraph"/><h5>Publishing Using the Gradle Maven-Publish (incubating) Plugin</h5><p class="paragraph"/>Plugin publication using the <a href="http://www.gradle.org/docs/current/userguide/publishing_maven.html" target="blank"><code>maven-publish</code></a> plugin
is not fully supported. This is an incubating plugin and dependency information is not generated correctly in the POM.
Specifically, at the time of writing, all dependencies were added to the <code>runtime</code> scope in the POM and installing the
resulting plugin in a project did not resolve transitive dependencies correctly.

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Task Rules</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Task%20Rules/grails-.html">grails-</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tasks</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Tasks/init-plugin.html">init-plugin</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tasks/init.html">init</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tasks/packagePlugin.html">packagePlugin</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tasks/run.html">run</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tasks/test.html">test</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tasks/war.html">war</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
